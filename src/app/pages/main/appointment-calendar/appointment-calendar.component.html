<div class="appointment-calender-container">
  <full-calendar [options]="calendarOptions"></full-calendar>

  <div class="calendar-legend">
    <div class="legend-item">
      <span class="legend-color pending"></span> Pending
    </div>
    <div class="legend-item">
      <span class="legend-color not-going"></span> Not Going
    </div>
    <div class="legend-item">
      <span class="legend-color going"></span> Going
    </div>
    <div class="legend-item">
      <span class="legend-color confirmed"></span> Highlighted: Confirmed by PMD
    </div>
  </div>
</div>

<p-dialog
  [header]="selectedEvent?.eventName || 'Appointment Details'"
  [(visible)]="visible"
  [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
  [appendTo]="'body'"
>
  <div class="appointment-dialog" *ngIf="selectedEvent">
    <div class="appointment-section">
      <h4 class="section-title">Appointment Details</h4>

      <div class="detail-grid">
        <div class="detail-item">
          <label class="detail-label">Date</label>
          <span class="detail-value">{{
            getFormattedDate(selectedEvent.date)
          }}</span>
        </div>

        <div class="detail-item">
          <label class="detail-label">Time</label>
          <span class="detail-value">{{
            getFormattedTime(selectedEvent.date)
          }}</span>
        </div>

        <div class="detail-item">
          <label class="detail-label">Job Title</label>
          <span class="detail-value">{{ selectedEvent.jobTitle }}</span>
        </div>

        <div class="detail-item">
          <label class="detail-label">Status</label>
          <span
            class="detail-badge"
            [ngClass]="{
              'status-pending': selectedEvent.status === 0,
              'status-going': selectedEvent.status === 1,
              'status-notgoing': selectedEvent.status === 2
            }"
          >
            {{ statusLabel }}
          </span>
        </div>

        <div
          class="detail-item"
          *ngIf="
            selectedEvent.fullData?.remarks &&
            selectedEvent.fullData.remarks.trim() !== ''
          "
        >
          <label class="detail-label">Response</label>
          <span class="detail-value">{{ selectedEvent.fullData.remarks }}</span>
        </div>

        <div class="detail-item" *ngIf="selectedEvent.isConfirmed">
          <label class="detail-label">Confirmation</label>
          <span class="detail-badge status-confirmed">Confirmed by PMD</span>
        </div>
      </div>
    </div>

    <!-- Response Buttons -->
    <div
      class="response-section"
      *ngIf="!isEventConfirmed && !showReasonTextarea"
    >
      <h4 class="section-title">Response</h4>
      <p class="section-desc">Will you be attending this appointment?</p>
      <div class="button-group">
        <p-button
          label="Going"
          icon="pi pi-check"
          (onClick)="onUpdateStatus(selectedEvent.appointmentId, 1)"
          styleClass="p-button-success"
        ></p-button>
        <p-button
          label="Not Going"
          icon="pi pi-times"
          (onClick)="onNotGoingClick()"
          styleClass="p-button-danger"
        ></p-button>
      </div>
    </div>

    <!-- Reason Section -->
    <div class="reason-section" *ngIf="showReasonTextarea">
      <h4 class="section-title">Reason for Not Attending</h4>
      <textarea
        pInputTextarea
        [(ngModel)]="notGoingReason"
        rows="4"
        placeholder="Enter your reason here..."
        class="reason-textarea"
        [autoResize]="true"
      ></textarea>

      <div class="button-group">
        <p-button
          label="Submit"
          icon="pi pi-send"
          (onClick)="onUpdateStatus(selectedEvent.appointmentId, 2)"
          [disabled]="!notGoingReason.trim()"
          styleClass="p-button-primary"
        ></p-button>
        <p-button
          label="Cancel"
          icon="pi pi-times"
          (onClick)="onCancelModal()"
          styleClass="p-button-secondary"
        ></p-button>
      </div>
    </div>

    <div *ngIf="isEventConfirmed" class="confirmed-message">
      <i class="pi pi-check-circle"></i>
      This appointment has been confirmed by PMD.
    </div>
  </div>
</p-dialog>
